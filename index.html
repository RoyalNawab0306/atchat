<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Welcome | At Chat</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

<style>
:root{
    --primary:#6366f1;
    --bg:#f3f4f6;
}
*{box-sizing:border-box}
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:var(--bg);
    display:flex;
    align-items:center;
    justify-content:center;
    height:100vh;
}
.auth-card{
    background:#fff;
    padding:30px;
    border-radius:24px;
    box-shadow:0 15px 35px rgba(0,0,0,0.1);
    width:100%;
    max-width:380px;
    text-align:center;
}
.tabs{
    display:flex;
    margin-bottom:25px;
    background:#eee;
    border-radius:12px;
    padding:5px;
}
.tab{
    flex:1;
    padding:10px;
    cursor:pointer;
    border-radius:10px;
    font-weight:600;
    color:#6b7280;
    transition:0.3s;
}
.tab.active{
    background:#fff;
    color:var(--primary);
    box-shadow:0 2px 10px rgba(0,0,0,0.05);
}
.form-section{display:none}
.form-section.active{display:block}
.input-group{
    position:relative;
    margin-bottom:15px;
}
.input-group i{
    position:absolute;
    left:15px;
    top:50%;
    transform:translateY(-50%);
    color:#9ca3af;
}
.input-group input{
    width:100%;
    padding:12px 15px 12px 45px;
    border:1px solid #e5e7eb;
    border-radius:12px;
    outline:none;
    font-size:15px;
}
.auth-btn{
    width:100%;
    padding:14px;
    background:var(--primary);
    color:#fff;
    border:none;
    border-radius:12px;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    margin-top:10px;
}
.auth-btn:disabled{
    opacity:0.7;
    cursor:not-allowed;
}
.msg{
    font-size:13px;
    margin-top:10px;
    padding:8px;
    border-radius:8px;
    display:none;
}
.error{background:#fee2e2;color:#ef4444}
.success{background:#dcfce7;color:#10b981}
</style>
</head>

<body>

<div class="auth-card">

<h2>Welcome</h2>

<div class="tabs">
    <div class="tab active" onclick="switchTab('login')">Login</div>
    <div class="tab" onclick="switchTab('register')">Register</div>
</div>

<!-- LOGIN -->
<form id="login-form" class="form-section active" onsubmit="event.preventDefault(); handleAuth('login');">
    <div class="input-group">
        <i class="fa-solid fa-phone"></i>
        <input type="tel" id="l-phone" placeholder="Phone Number" required>
    </div>
    <div class="input-group">
        <i class="fa-solid fa-lock"></i>
        <input type="password" id="l-password" placeholder="Password" required>
    </div>
    <button type="submit" class="auth-btn" id="login-btn">Login</button>
</form>

<!-- REGISTER -->
<form id="register-form" class="form-section" onsubmit="event.preventDefault(); handleAuth('register');">
    <div class="input-group">
        <i class="fa-solid fa-user"></i>
        <input type="text" id="r-name" placeholder="Full Name" required>
    </div>
    <div class="input-group">
        <i class="fa-solid fa-phone"></i>
        <input type="tel" id="r-phone" placeholder="Phone Number" required>
    </div>
    <div class="input-group">
        <i class="fa-solid fa-lock"></i>
        <input type="password" id="r-password" placeholder="Create Password" required>
    </div>
    <button type="submit" class="auth-btn" id="register-btn">Create Account</button>
</form>

<div id="status-msg" class="msg"></div>

</div>

<script>

const API_URL = "https://atchat.page.gd/api.php";
const SECRET_KEY = "ABHAY_SECRET_2026";

if (localStorage.getItem("token")) {
    window.location.href = "chat.html";
}

function switchTab(type){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.form-section').forEach(f=>f.classList.remove('active'));

    if(type==="login"){
        document.querySelectorAll('.tab')[0].classList.add('active');
        document.getElementById('login-form').classList.add('active');
    }else{
        document.querySelectorAll('.tab')[1].classList.add('active');
        document.getElementById('register-form').classList.add('active');
    }
}

async function handleAuth(action){

    const msg = document.getElementById("status-msg");
    msg.style.display="none";

    const btn = action==="login" ? 
        document.getElementById("login-btn") :
        document.getElementById("register-btn");

    btn.disabled=true;
    btn.innerText="Please wait...";

    let payload={action,secret:SECRET_KEY};

    if(action==="login"){
        payload.phone=document.getElementById("l-phone").value.trim();
        payload.password=document.getElementById("l-password").value.trim();
    }else{
        payload.name=document.getElementById("r-name").value.trim();
        payload.phone=document.getElementById("r-phone").value.trim();
        payload.password=document.getElementById("r-password").value.trim();
    }

    const phoneRegex=/^[0-9]{10}$/;
    if(!phoneRegex.test(payload.phone)){
        showMsg("Enter valid 10 digit phone number","error");
        resetBtn(btn,action);
        return;
    }

    if(payload.password.length<6){
        showMsg("Password must be at least 6 characters","error");
        resetBtn(btn,action);
        return;
    }

    try{
        const res=await fetch(API_URL,{
            method:"POST",
            headers:{
                "Content-Type":"application/json"
            },
            body:JSON.stringify(payload)
        });

        if(!res.ok) throw new Error();

        const data=await res.json();

        if(data.status==="success"){

            if(action==="login"){
                localStorage.setItem("token",data.user.token);
                localStorage.setItem("user",JSON.stringify(data.user));
                window.location.href="chat.html";
            }else{
                showMsg("Registration successful! Please login.","success");
                switchTab("login");
            }

        }else{
            showMsg(data.message,"error");
        }

    }catch{
        showMsg("Server Error!","error");
    }

    resetBtn(btn,action);
}

function showMsg(text,type){
    const msg=document.getElementById("status-msg");
    msg.innerText=text;
    msg.className="msg "+type;
    msg.style.display="block";
}

function resetBtn(btn,action){
    btn.disabled=false;
    btn.innerText= action==="login" ? "Login" : "Create Account";
}

</script>

</body>
</html>


